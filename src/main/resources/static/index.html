<html lang='en'>

<head>
    <meta charset='utf-8' />
    <link href='css/main.css' rel='stylesheet' />
    <script src='js/main.js'></script>
    <script>
        let rooms;
        let appointments;
        let events = [];
        let calendar;

        async function initializeData() {
            const roomsRequest = await fetch("http://127.0.0.1:8080/allRooms", {
                "Accept": "application/json"
            });
            const roomsJson = await roomsRequest.text();
            rooms = JSON.parse(roomsJson);
            const appointmentsRequest = await fetch("http://127.0.0.1:8080/allAppointments", {
                "Accept": "application/json"
            });
            const appointmentsJson = await appointmentsRequest.text();
            appointments = JSON.parse(appointmentsJson);
            parseAppointments(appointments);
        }

        class Event {
            constructor(title, start, end) {
                this.title = title,
                    this.start = start,
                    this.end = end
            }

        }

        function parseAppointments(appointments) {
            appointments.forEach(app => events.push({
                "title": app.id,
                "end": new Date(app.endTime).toISOString(),
                "start": new Date(app.startTime).toISOString()
            }))
        }

        function initCalendar() {

            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek'
                },
                dateClick: function(info) {
                    toggleForm(info.dateStr);
                },
                initialView: 'dayGridMonth',
                events: events
            });
            calendar.render();
        }

        window.onload = async function() {
            await initializeData();
            initCalendar();

        };

        function toggleForm(dateStr) {

            if (document.getElementById("overlay").style.display == "block") {
                document.getElementById("overlay").style.display = "none";
                document.getElementById("form").style.display = "none";
            } else {
                document.getElementById("overlay").style.display = "block";
                document.getElementById("form").style.display = "block";
            }
        }

    </script>
</head>

<body>
    <div id="calendar"></div>

    <div id="overlay">
    </div>
    <div id="form">
        <div>
            <label>Start:
                <input id="startTime" type="datetime-local">
            </label>
        </div>
        <div>
            <label>Ende:
                <input id="endTime" type="datetime-local">
            </label> </div>
        <button onclick="toggleForm()" type=" button">Termin anlegen</button>
    </div>
</body>

<style>
    #overlay {
        display: none;
        background-color: lightgray;
        opacity: 0.6;
        width: 100%;
        height: 100%;
        position: fixed;
        top: 0px;
        z-index: 5;
    }

    #form {
        display: none;
        background-color: white;
        width: 50%;
        height: 50%;
        position: absolute;
        left: 25%;
        top: 25%;
        z-index: 6;
    }

</style>

</html>
