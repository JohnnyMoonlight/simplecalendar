<html lang='en'>

<head>
    <meta charset='utf-8' />
    <link href='css/main.css' rel='stylesheet' />
    <script src='js/main.js'></script>
    <script>
        let rooms;
        let appointments;
        let events = [];
        let calendar;

        async function initializeData() {
            const roomsRequest = await fetch("http://127.0.0.1:8080/allRooms", {
                "Accept": "application/json"
            });
            const roomsJson = await roomsRequest.text();
            rooms = JSON.parse(roomsJson);
            const appointmentsRequest = await fetch("http://127.0.0.1:8080/allAppointments", {
                "Accept": "application/json"
            });
            const appointmentsJson = await appointmentsRequest.text();
            appointments = JSON.parse(appointmentsJson);
            parseAppointments(appointments);
        }

        class Event {
            constructor(title, start, end) {
                this.title = title,
                    this.start = start,
                    this.end = end
            }

        }

        function parseAppointments(appointments) {
            appointments.forEach(app => events.push({
                "title": app.id,
                "end": new Date(app.endTime).toISOString(),
                "start": new Date(app.startTime).toISOString()
            }))
        }

        function initCalendar() {

            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                initialView: 'dayGridMonth',
                events: events
            });
            calendar.render();
        }

        window.onload = async function() {
            await initializeData();
            initCalendar();

        };
    </script>
</head>

<body>
    <div id='calendar'></div>
</body></html>